<button onclick="GoBack()" type="button" class="btn btn-primary">
  BACK</button>
<% if !current_user.active_player.isActivePlayer %>
    <h1>Awaiting opponent's turn</h1>
    <img src= "/images/wait_centerspin.png" id="center">
    <img src= "/images/spinner.png" id="spinner">
<% elsif current_user.active_player.challenges.first.nil?%>
    <h1>Spin the Wheel!!!</h1>
    <img src= "/images/centerspin.png" id="center">
    <img src= "/images/spinner.png" id="spinner">
<% else %>
    <h1>You have been challenged!</h1>
    <br>
    <button onclick="StartChallenge()" type="button" class="btn btn-primary btn-lg btn-block">
      Start Challenge!
    </button>
    <br>
<% end %>
<p>Meter: <%= current_user.active_player.meter%></p>
<p>#Correct to Next Level: <%= @until_level_up%></p>
<p>Is in challenge: <%= !current_user.active_player.challenges.first.nil?%></p>
<% if (!current_user.active_player.opponent.nil?) %>
    <p>Opponent: <%= current_user.active_player.opponent.user.email%></p>
    <p>Opponent is in challenge: <%= !current_user.active_player.opponent.challenges.first.nil?%></p>
<% end %>

<div id="trophy">
  <% current_user.active_player.trophies.each do |trophy|  %>

      <img src= <%= trophy.icon_path%>>

  <% end %>
</div>

<script type ="text/javascript" charset="utf-8">

    jQuery(document).ready(function()
    {
        var rotations = Math.floor((Math.random() * 100000) + 80000);
        var category_number = rotations % 360;
        $("#center").rotate({
            bind:
            {
                click: function(){
                    $.ajax({
                        url: "play/get_random_category",
                        type: 'PUT',
                        dataType: 'json',
                        data: {'rotations' : rotations}
                    });
                    <% if current_user.active_player.isActivePlayer && current_user.active_player.challenges.first.nil?%>
                     $("#spinner").rotate({ angle:0,animateTo: rotations,easing: $.easing.easeInOutExpo });
                    spinSound.playclip();
                    if (category_number >= 309 && category_number <= 359) {
                        setTimeout(GetFullMeterChoice, 1000);
                    }
                    else {
                        setTimeout(GetQuestions, 1000);
                    }
                    <% end %>
                }
            }
        });
    });
    function GetFullMeterChoice()
    {
        $('body').load('/play/display_full_meter_choice.html');
    }
    function GoBack()
    {
        $('body').load('play/index');
    }

    function StartChallenge()
    {
        $.ajax({
            url: "play/continue_challenge",
            type: 'PUT'
        });
        setTimeout(GetQuestions, 500);
    }

    function GetQuestions()
    {
        $('body').load('/play/display_questions.html');
    }
</script>